<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack(4.0) | 😈Singee</title>
    <meta name="description" content="this is singee blog ">
    
    
    <link rel="preload" href="/assets/css/0.styles.b1fe51a6.css" as="style"><link rel="preload" href="/assets/js/app.c7624f26.js" as="script"><link rel="preload" href="/assets/js/2.04cf5e0d.js" as="script"><link rel="preload" href="/assets/js/23.bc303b71.js" as="script"><link rel="prefetch" href="/assets/js/10.d5f1c1ec.js"><link rel="prefetch" href="/assets/js/11.1d509d1f.js"><link rel="prefetch" href="/assets/js/12.72ae5236.js"><link rel="prefetch" href="/assets/js/13.13838250.js"><link rel="prefetch" href="/assets/js/14.10f33b47.js"><link rel="prefetch" href="/assets/js/15.ce547b37.js"><link rel="prefetch" href="/assets/js/16.1692188e.js"><link rel="prefetch" href="/assets/js/17.06ee366a.js"><link rel="prefetch" href="/assets/js/18.00311757.js"><link rel="prefetch" href="/assets/js/19.a4d6a3c8.js"><link rel="prefetch" href="/assets/js/20.71ca09e7.js"><link rel="prefetch" href="/assets/js/21.a898dac2.js"><link rel="prefetch" href="/assets/js/22.a8bbb495.js"><link rel="prefetch" href="/assets/js/24.0192cd3f.js"><link rel="prefetch" href="/assets/js/25.1b343f01.js"><link rel="prefetch" href="/assets/js/26.3fd09c06.js"><link rel="prefetch" href="/assets/js/27.2cdcf487.js"><link rel="prefetch" href="/assets/js/28.64cbf829.js"><link rel="prefetch" href="/assets/js/29.7e75ffef.js"><link rel="prefetch" href="/assets/js/3.fea3fce9.js"><link rel="prefetch" href="/assets/js/4.6576419b.js"><link rel="prefetch" href="/assets/js/5.706d86fc.js"><link rel="prefetch" href="/assets/js/6.94b2acc6.js"><link rel="prefetch" href="/assets/js/7.d7b9eeed.js"><link rel="prefetch" href="/assets/js/8.24d4bb66.js"><link rel="prefetch" href="/assets/js/9.1e274f4c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b1fe51a6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">😈Singee</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/pages/article/" class="nav-link">😄文章</a></div><div class="nav-item"><a href="/pages/source/" class="nav-link">😜源码解析</a></div><div class="nav-item"><a href="/pages/base/" class="nav-link">🤨基础</a></div><div class="nav-item"><a href="/pages/dp/" class="nav-link">⌛设计模式</a></div><div class="nav-item"><a href="/pages/middle/" class="nav-link router-link-active">😵技术栈</a></div><div class="nav-item"><a href="/pages/build/" class="nav-link">🤗工程</a></div> <a href="https://github.com/xiangxinji/myblog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    source code
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pages/article/" class="nav-link">😄文章</a></div><div class="nav-item"><a href="/pages/source/" class="nav-link">😜源码解析</a></div><div class="nav-item"><a href="/pages/base/" class="nav-link">🤨基础</a></div><div class="nav-item"><a href="/pages/dp/" class="nav-link">⌛设计模式</a></div><div class="nav-item"><a href="/pages/middle/" class="nav-link router-link-active">😵技术栈</a></div><div class="nav-item"><a href="/pages/build/" class="nav-link">🤗工程</a></div> <a href="https://github.com/xiangxinji/myblog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    source code
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">😈首页</a></li><li><a href="/pages/base/" class="sidebar-link">🤨基础东东</a></li><li><a href="/pages/middle/" class="sidebar-link">📁技术栈</a></li><li><a href="/pages/source/" class="sidebar-link">🧪源代码分析</a></li><li><a href="/pages/article/webpack/" class="sidebar-link">🧫随便写写的文章</a></li><li><a href="/pages/dp/" class="sidebar-link">⌛设计模式</a></li><li><a href="/pages/build/" class="sidebar-link">🍽️工程化</a></li><li><a href="/pages/years/2019.html" class="sidebar-link">😳年终总结</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-4-0"><a href="#webpack-4-0" class="header-anchor">#</a> Webpack(4.0)</h1> <img src="/images/webpack.jpg" alt="Vue"> <p><a href="https://www.webpackjs.com/" target="_blank" rel="noopener noreferrer">webpack中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="code-splitting-代码拆分"><a href="#code-splitting-代码拆分" class="header-anchor">#</a> Code Splitting  (代码拆分)</h3> <p>Code Splitting 与 webpack 无关   , 实现代码拆分有很多种形式</p> <ol><li>手动加载 第三方依赖的入口文件,进行打包</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>entry<span class="token punctuation">:</span><span class="token punctuation">{</span>
  lodash <span class="token punctuation">:</span> <span class="token string">'../src/lodash.js'</span> <span class="token punctuation">,</span>  <span class="token comment">// 这里引入了lodash 并赋值给 window对象,  那么webpack 会先打包								// 出这个入口文件 , 然后再去打包index.js , 至此就完成了第一种区							  // 分打包</span>
  main <span class="token punctuation">:</span> <span class="token string">'../src/index.js'</span> <span class="token comment">// 业务逻辑的入口文件 </span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li><p>同步加载</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span> <span class="token punctuation">;</span> <span class="token comment">// 1. 同步加载第三方模块 </span>
 <span class="token comment">// _.xx()   </span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后在webpack配置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization <span class="token punctuation">:</span> <span class="token punctuation">{</span>
    splitChunks <span class="token punctuation">:</span> <span class="token punctuation">{</span>
      chunks <span class="token punctuation">:</span> <span class="token string">'all'</span> <span class="token punctuation">,</span>   <span class="token comment">// 让同步模块和异步模块都进行代码分离 </span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h3 id="optimization-splitchunks-配置"><a href="#optimization-splitchunks-配置" class="header-anchor">#</a> optimization.splitChunks  配置</h3> <div class="language-javasciprt line-numbers-mode"><pre class="language-text"><code>module.exports = {
  optimization : {
    splitChunks : {
      chunks : 'async' ,   // 异步模块进行代码分离
      // 默认值async,all:异步|同步模块都进行代码分离,initial 同步模块
      minSize : 30000 ,  // 模块必须大于30000字节才会进行代码分离
      maxSize : 0  ,	// 生成代码块的最大大小,如果此模块大于这个maxSize 那么他可能会进行二次拆分 
      minChunks : 1 , // 打包之后的Chunk引用此模块时 Chunk引用此模块数 &gt;=minChunks 才会对此模块进行代码分割 
      maxAsyncRequests : 5 , // 按需加载时并行请求的最大数量。
      maxInitialRequests:3 , // 入口文件的模块最大拆分数  
      automaticNameDelimiter : '~' , //拆分文件名的默认连接符
      name : true , // 分割块的名称。提供true将根据块和缓存组键自动生成名称。
      cacheGroups: { // 缓存组
       	 vendors : {	// vendor组
           	 test: /[\\/]node_modules[\\/]/, // 匹配处于node_modules中的模块
          	 priority: -10	// 优先级   数值越大越高
          	 filename : 'vendor.js'
       	 },
       	 default : {	// 默认组 
       	 	priority : -20 , // 优先级 
       	 	reuseExistingChunk : true ,   //  如果当前块包含已经从主包中分离出来的模块，那么它将被重用，而不是生成一个新的模块。这可能会影响块的结果文件名。
       	 	filename : 'default.js'
       	 }	
      }
    }
  } 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="懒加载"><a href="#懒加载" class="header-anchor">#</a> 懒加载</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>当webpack 遇到异步加载模块时<span class="token punctuation">,</span>webpack会进行懒加载来提升性能<span class="token punctuation">,</span>什么时候加载关机键点在于什么时候引入此模块
vue 中的router  就是通过异步加载模块来让webpack进行懒加载功能



<span class="token comment">// chunk : 当webapck 打包出来之后 ,每有一个文件就算一个chunk </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="分析工具"><a href="#分析工具" class="header-anchor">#</a> 分析工具</h3> <p>webpack 官方提供了非常多的分析工具，来分析打包的过程和结果</p> <p>首先得得到一个分析结果文件  。 一般叫做 state.json</p> <p>webpack --profile --json &gt; stats.json</p> <p>官方推荐分析工具、网站</p> <p>https://webpack.js.org/guides/code-splitting/#bundle-analysis</p> <h3 id="prefetching-preloading-modules-空闲加载-预加载-模块"><a href="#prefetching-preloading-modules-空闲加载-预加载-模块" class="header-anchor">#</a> Prefetching/Preloading modules (空闲加载/预加载) 模块</h3> <p>webpack配置文件中</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>optimization<span class="token punctuation">:</span><span class="token punctuation">{</span>
  splitChunks <span class="token punctuation">:</span> <span class="token punctuation">{</span>
    chunks <span class="token punctuation">:</span> <span class="token string">'async'</span>  <span class="token comment">// async 为默认值 </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>webpack 比较推荐的方式是 异步加载 ， 因为只需要加载可使用的模块</p> <p>(空闲加载/预加载) 模块  这个的用处在于 ， 当一个异步模块更换他的加载方式时，可以使用空闲加载此异步模块，还是预加载异步模块</p> <p>在webpack中可以使用魔法注释来完成空闲加载/预加载 异步模块</p> <p>例:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 此异步模块会进行空闲加载 </span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> handleClick<span class="token punctuation">:</span> fun <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span><span class="token string">'./click.js'</span><span class="token punctuation">)</span>

<span class="token comment">// 此异步模块会进行预先加载 </span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> handleClick<span class="token punctuation">:</span> fun <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPreload: true */</span><span class="token string">'./click.js'</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>具体文档 ： https://webpack.js.org/guides/code-splitting/#bundle-analysis</p> <p>可以查看chrome开发者工具中的 coverage 来查看代码的利用率 ，  通常来说， 代码利用率越高，网页性能越好</p> <h3 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h3> <p>对于webpack来说,可以使用 [contenthash] 来进行缓存管理 , 如果代码没有进行改变的话,hash不会变化</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>output<span class="token punctuation">:</span><span class="token punctuation">{</span>
  filename <span class="token punctuation">:</span> <span class="token string">'main[contenthash].js'</span><span class="token punctuation">,</span>
  chunkFilename <span class="token punctuation">:</span> <span class="token string">'[name][contenthash].js'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在老版本的webpack中 入口chunk 可能每次对应的contenthash 可能不一样,因为webpack默认将运行时的代码放入入口chunk中,这些运行时的代码可能每次运行都不一样 , 所以才导致入口chunk 每次对应的contenthash不一样解决这个问题:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>optimization <span class="token punctuation">:</span> <span class="token punctuation">{</span>
  runtimeChunk <span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name <span class="token punctuation">:</span> <span class="token string">'runtime'</span> <span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="shimming"><a href="#shimming" class="header-anchor">#</a> Shimming</h3> <p>用来处理兼容问题 . .</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 当你使用 _ 对象时 , webpack 会去使用 loadsh 中的模块对象  </span>
<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       _<span class="token punctuation">:</span> <span class="token string">'lodash'</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="hmr"><a href="#hmr" class="header-anchor">#</a> HMR</h2> <p>HMR (hot module replacement ) 热模块替换</p> <p>webpack 有两种方式来开启开发服务器</p> <ol><li>WDS</li> <li>WDM</li></ol> <p>WDS : 通过webpack-dev-server 这个插件来运行开发服务器,此时只要代码有改动,前端的html页面就会自动刷新</p> <p>WDM : 通过自己给nodejs服务器加上webpack-dev-middleware 的中间件来进行文件监听,并刷新</p> <p>WDM 相对于 WDS 来说的话,WDM的自定义性更高,因为我们可以在自己的nodejs服务器里做出其他更多的事情</p> <p>WDM原理 : WDM 将webpack输出的文件以json格式传输给服务器,来完成文件监听</p> <h2 id="文件指纹"><a href="#文件指纹" class="header-anchor">#</a> 文件指纹</h2> <p>文件指纹一般用于版本管理</p> <ol><li>hash : 项目相关,只要项目文件有修改,hash值就会改变</li> <li>chunkhash : 和webpack打包的chunk有关,不同的entry 会生成不同的chunk值</li> <li>contenthash : 根据文件内容定义hash</li></ol> <h2 id="文件压缩"><a href="#文件压缩" class="header-anchor">#</a> 文件压缩</h2> <p>webpack4 自带js压缩,他是通过  uglifyjs-webpack-plugin  这一个插件来进行js压缩的,默认是串行压缩</p> <p>css压缩呢,需要利用 optimize-css-assets-webpack-plugin  插件和另外一个依赖 cssnano 来进行css 压缩</p> <p>html 压缩就是 html-webpack-plugin 来进行html压缩</p> <h2 id="css3-自动补齐前缀"><a href="#css3-自动补齐前缀" class="header-anchor">#</a> css3 自动补齐前缀</h2> <p>依赖: post-cssloader + autoprefixer 插件</p> <p>里面配置的browsers 可以设置要兼容的浏览器范围</p> <h2 id="自动rem转换-移动端"><a href="#自动rem转换-移动端" class="header-anchor">#</a> 自动REM转换(移动端)</h2> <p>依赖: px2remloader + lib-flexible</p> <h2 id="静态资源内联"><a href="#静态资源内联" class="header-anchor">#</a> 静态资源内联</h2> <p>可以使用raw-loader 来内联html 和 js</p> <p>css内联 : 使用html-inline-css-webpack-plugin</p> <h2 id="打包多页面"><a href="#打包多页面" class="header-anchor">#</a> 打包多页面</h2> <p>好处是: 解耦合,利于seo</p> <p>利用 glob 库来读取文件并动态生成 webpack.config 的entry 入口 和 html-webpack-plugin 来进行多页面打包</p> <h2 id="source-map"><a href="#source-map" class="header-anchor">#</a> source-map</h2> <p>源代码映射: 开发环境一般开启,生产环境直接关闭</p> <h2 id="提取公共资源"><a href="#提取公共资源" class="header-anchor">#</a> 提取公共资源</h2> <p>一些基础库: 可以利用html-webpack-externals-plugins 来选择不打包这些公共库,但是可以让他们去cdn 里面加载</p> <p>还有一种方式就是利用 splitChunksPlugin</p> <h2 id="treeshaking"><a href="#treeshaking" class="header-anchor">#</a> TreeShaking</h2> <p>TressShaking 摇树优化, (commonjs 不支持) 他的原理是DCE</p> <p>DCE 有三点</p> <ol><li>代码不可达</li> <li>结果不被用到</li> <li>变量只写不读</li></ol> <p>production 模式 默认开启</p> <h2 id="scopehoisting"><a href="#scopehoisting" class="header-anchor">#</a> ScopeHoisting</h2> <p>在开发环境,默认webpack会进行大量的闭包来进行模块的导入及导出操作,ScopeHoisting 可以减少使构建出的函数申明代码和内存开销</p> <p>production 模式默认开启</p> <h2 id="懒加载js的方式"><a href="#懒加载js的方式" class="header-anchor">#</a> 懒加载JS的方式</h2> <p>commonjs : require.ensure</p> <p>es6: 动态import 需要babel 插件 来支持这样的语法</p> <h2 id="打包一个自己的组件和库"><a href="#打包一个自己的组件和库" class="header-anchor">#</a> 打包一个自己的组件和库</h2> <p>一般的组件和库有两个版本,一个是压缩版,一个是非压缩版,通常情况下是非生产环境下使用非压缩版,生产环境下使用压缩版,</p> <p>通过配置target: umd , 来支持 amd, cjs , es模块, script 标签</p> <p>通过设置library 等相关配置</p> <p>然后利用TerserPlugin 插件来进行匹配压缩 , 例如只压缩 .min.js 结尾的文件</p> <h2 id="ssr-空缺"><a href="#ssr-空缺" class="header-anchor">#</a> SSR 空缺</h2> <h2 id="优化构建日志"><a href="#优化构建日志" class="header-anchor">#</a> 优化构建日志</h2> <p>通过stats设置来完成统计信息的过滤 , 一般使用  'errors-only'  或者  'minimal'</p> <p>然后借助  friendly-errors-webpack-plugin  这个插件来进行友好的信息提示 .</p> <p>然后还可以通过自己编写 一个小插件来绑定webpack打包完成的事件来进行自定义操作</p> <h2 id="打包速度分析"><a href="#打包速度分析" class="header-anchor">#</a> 打包速度分析</h2> <p>利用  speed-measure-webpack-plugin  插件 来进行打包速度分析</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 实例化插件</span>
<span class="token keyword">const</span> smp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeedMeasurePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> smp<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	entry <span class="token punctuation">:</span> <span class="token string">'..xxx'</span><span class="token punctuation">,</span>
    output <span class="token punctuation">:</span> <span class="token string">'xxx'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="多进程多实例构建"><a href="#多进程多实例构建" class="header-anchor">#</a> 多进程多实例构建</h2> <p>利用官方推出的 thread-loader , 当然也有其他第三方的多线程构建插件,就是HappyPack , webpack 官方推荐thread-loader来进行多实例构建</p> <p>把这个 loader 放置在其他 loader 之前， 放置在这个 loader 之后的 loader 就会在一个单独的 worker 池(worker pool)中运行</p> <p><a href="https://www.webpackjs.com/loaders/thread-loader/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="多进程多实例压缩"><a href="#多进程多实例压缩" class="header-anchor">#</a> 多进程多实例压缩</h2> <p>利用  terser-webpack-plugin    开启 parallel 参数 （推荐使用这个，支持 ES6 语法压缩） , 当然还有其他的插件, 例如 parallel-uglify-plugin  ,  uglifyjs-webpack-plugin  等</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
       <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
         parallel<span class="token punctuation">:</span> <span class="token number">4</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="dll-打包"><a href="#dll-打包" class="header-anchor">#</a> DLL 打包</h2> <p>dll 类似于将你想要的模块放入一个公共仓库,然后打包的时候就直接去这个公共仓库里面取</p> <p>想要完成dll 打包 得先完成两步</p> <ol><li>写一个webpack.dll.js 来生成 manifest.json文件和仓库js</li> <li>在你要构建的主文件加入这个dll插件(和生成dll的插件不是同一个)</li></ol> <p>示例</p> <p>生成manifest.json 文件如下</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        resolver<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'vue$'</span><span class="token punctuation">:</span> <span class="token string">'vue/dist/vue.esm.js'</span> <span class="token comment">//内部为正则表达式  vue结尾的</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 要生成的模块为 vendor , 里面包含 vue和lodash 模块 </span>
        vendor<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token string">'vue'</span><span class="token punctuation">,</span>
            <span class="token string">'lodash'</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 生成的 仓库 js 为 vendor.dll.js</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].dll.js'</span><span class="token punctuation">,</span>
        <span class="token comment">// 将仓库文件存放至 .... </span>
        path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/librarys'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// library 名字为 vendor </span>
        library<span class="token punctuation">:</span> <span class="token string">'[name]'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'[name]'</span><span class="token punctuation">,</span>
            <span class="token comment">// 生成mainifest.json 文件的位置 </span>
            path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dll/manifest.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>然后在主文件中加入此插件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 引用的上下文 </span>
      		context<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token punctuation">,</span> <span class="token string">'../'</span> <span class="token punctuation">,</span> <span class="token string">'dll/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 基于上下文去找vendor.dll.js</span>
      		name <span class="token punctuation">:</span> <span class="token string">'vendor'</span> <span class="token punctuation">,</span>
      		<span class="token comment">// 引入js</span>
            manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dll/manifest.json'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="缓存构建"><a href="#缓存构建" class="header-anchor">#</a> 缓存构建</h2> <p>缓存构建就是将第一次构建的一些东西缓存起来 , 缓存目录为 node_modules 中的 .cache 文件夹中</p> <p>缓存构建分为三种构建</p> <ol><li>babel 转换缓存</li> <li>terser-webpack-plugin  压缩缓存</li> <li>hard-source-webpack-plugin  业务模块缓存</li></ol> <p>一个一个来:</p> <p>babel缓存</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
   loader<span class="token punctuation">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
   options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         cacheDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 开启缓存</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>terser 缓存</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                parallel<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                cache<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 开启缓存</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>业务缓存</p> <p>加入这个插件即可</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
 	<span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    
 <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="图片压缩"><a href="#图片压缩" class="header-anchor">#</a> 图片压缩</h2> <p>虽然有url-loader 来完成指定大小内图片将转为base64.但是在大图片的情况下 我们还是希望能自动化的完成图片压缩
在教程上面看的使用 imagemin-webpack-plugin 这个插件来完成这个自动化功能, 但是本人试的时候不仅没效果还贼慢,估计是碰到坑了 , 所以转念换了另外一个方式
.使用 image-webpack-loader</p> <p>下面直接看代码</p> <p>首先安装image-webpack-loader</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i -D image-webpack-loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>载入配置</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>        <span class="token punctuation">{</span>
                test<span class="token punctuation">:</span> <span class="token regex">/\.(png|svg|jpeg|jpg)$/i</span><span class="token punctuation">,</span>
                use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                            limit<span class="token punctuation">:</span> <span class="token number">50000</span><span class="token punctuation">,</span>
                            name<span class="token punctuation">:</span> <span class="token string">'images/[name]_[hash].[ext]'</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token punctuation">:</span> <span class="token string">&quot;image-webpack-loader&quot;</span> <span class="token punctuation">,</span>
                        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                            bypassOnDebug <span class="token punctuation">:</span><span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>此时  image-webpack-loader 就会自动将图片进行压缩,并且好像会存放至image 目录中</p> <p>End</p> <h2 id="csstreeshaking"><a href="#csstreeshaking" class="header-anchor">#</a> CSSTreeShaking</h2> <p>抹除没有用到的css</p> <p>日常第一步 安装</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>    <span class="token function">npm</span> i -D glob-all purify-css purifycss-webpack 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后就开始配置 添加这个插件</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code> <span class="token keyword">new</span> <span class="token class-name">PurifyCSS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 读取 src下面的 所有的html 和 所有的js , 来扫描是否使用到了这个css 选择器 </span>
    paths<span class="token punctuation">:</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
             path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token punctuation">,</span> <span class="token string">'../'</span> <span class="token punctuation">,</span> <span class="token string">'src/*/*.html'</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
             path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname <span class="token punctuation">,</span> <span class="token string">'../'</span> <span class="token punctuation">,</span> <span class="token string">'src/*/*.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>稍微注意一下的是, 如果配置错误,你打包出来的css 将会没有内容
End</p> <h2 id="动态polyfill"><a href="#动态polyfill" class="header-anchor">#</a> 动态polyfill</h2> <p>让babel-core 解决 es6箭头函数 等等语法问题 , 然后使用动态polyfill 来根据浏览器的User-Agent 来进行自动获取polyfill</p> <p>其实就是一段script 标签, 然后我们使用 阿里 提供的</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://polyfill.alicdn.com/polyfill.min.js?features=Promise%2CArray.prototype.includes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>他们采用features 来控制你需要的polifll 兼容, 如果不传默认 就默认全局polyfll</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">singee write to :</span> <span class="time">12/16/2019, 10:25:35 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c7624f26.js" defer></script><script src="/assets/js/2.04cf5e0d.js" defer></script><script src="/assets/js/23.bc303b71.js" defer></script>
  </body>
</html>
